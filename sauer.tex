% !TEX root = sputnik.tex
\documentclass[sputnik.tex]{subfiles}
\begin{document}
\chapter{The Sauer-Shelah Lemma}
\label{sauer}

\def\vc{{\footnotesize VC}}
\def\nip{{\footnotesize NIP}}


\def\medrel#1{\parbox[t]{6ex}{$\displaystyle\hfil #1$}}
\def\ceq#1#2#3{\parbox[t]{25ex}{$\displaystyle #1$}\medrel{#2}{$\displaystyle #3$}}

\definecolor{brown}{RGB}{150, 50, 10}
\definecolor{green}{RGB}{10,120, 20}
\def\mr{\color{brown}}
\def\gr{\color{green}}

%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%
\section{Two equivalent frameworks}\label{vc_dimension}

Let $\U$ and $\V$ be two sets. 
A binary relation $\phi\subseteq \U\times\V$ is identified with a \emph{bipartite graph}.
We may call $\phi$ an \emph{(abstract or generalized) incidence relation\/} and write $\phi(x,y)$ for $\<x,y\>\in\phi$.
Sets of the form

\ceq{\hfill\emph{$\phi(\U,b)$}}{=}{\{a\in\U:\phi(a,b)\}}

are called \emph{definable sets\/} or, when more than one relation is involved, \emph{$\phi$-definable sets}.
The collection of all definable sets is denoted by \emph{$\phi(\U,b)_{b\in\V}$}.

Often we need to consider the \emph{trace\/} of a definable set on some arbitrary $A\subseteq\U$

\ceq{\hfill\emph{$\phi(A,b)$}}{=}{\{a\in A:\phi(a,b)\}.}

We call this a \emph{definable subset of $A$\/} and denote by \emph{$\phi(A,b)_{b\in\V}$\/} the collection of definable subsets on $A$.

Given $A\subseteq\U$ define the equivalence relation $\equiv_{\phi,A}$ defined by 

\ceq{\hfill\emph{$b\equiv_{\phi,A} b'$}}{\IFF}{\phi(a,b)\iff\phi(a,b')}\quad for all $a\in A$;

\ceq{}{\IFF}{\phi(A,b)=\phi(A,b').}

The $\equiv_{\phi,A}$-equivalence class are called \emph{types over $A$}. We denote by $S_\phi(A)$ the set types over $A$. As there is a one-to-one correspondence between definable subsets and types, $|S_\phi(A)|=|\phi(A,b)_{b\in\V}|$. 

If all subsets of $A$ are definable, that is $\P A=\phi(A,b)_{b\in\V}$, we say that $A$ is \emph{shattered\/} by $\phi$. Paraphrase the the definition,  $A$ is shattered by $\phi$ if fr every $C\subseteq A$ there is a $b_C\in\V$ such that $C=\phi(A,b_C)$.

The following is called the \emph{shatter function\/}

%\ceq{\hfill\emph{$\pi_\phi(n)$}}{=}{\max\Big\{|\phi(A,b)_{b\in\V}|\ \ :\ \ A\subseteq\U,\ |A|=n\Big\}.}

\ceq{\hfill\emph{$\pi_\phi(n)$}}{=}{\max\bigg\{|\phi(A,b)_{b\in\V}|\ \ :\ \ A\in {\U\choose n}\bigg\}}

\ceq{}{=}{\max\bigg\{\kern2ex|S_\phi(A)|\kern2.5ex\ \ :\ \  A\in {\U\choose n}\bigg\}.}

So, $\pi_\phi(n)$ gives the maximal number of definable subsets that a set of cardinality $n$ may have.
Trivially, $\pi_\phi(n)\le2^n$ for all $n$.
Moreover, if $\pi_\phi(k)=2^k$ for some $k$, then $\pi_\phi(n)=2^n$ for every $n\le k$.

The dual relation $\phi^*$ is the relation on $\V\times\U$ which is sometimes denoted by $\phi^{-1}$.
Then dual scattering function is defined as follows (with the obvious meaning of the notation) 

\ceq{\hfill\emph{$\pi^*_\phi(n)$}}{=}{\max\bigg\{|\phi(a,B)_{a\in\U}|\ \ :\ \ B\in {\V\choose n}\bigg\}}

\ceq{}{=}{\max\bigg\{\kern2ex|S_{\phi^*}(B)|\kern2.2ex\ \ :\ \  B\in {\V\choose n}\bigg\}.}

\begin{definition}\label{def_VCdim}
The \emph{Vapnik-Cher\-vo\-nen\-kis dimension\/} of $\phi$, abbreviated by \emph{\vc-dimension}, is the maximal cardinality of a finite set $A\subseteq\U$ that is shattered by $\phi$.
Equivalently, it is the maximal $k$ such that $\pi_\phi(k)=2^k$.
If such a maximum does not exist,
we say that $\phi$ has infinite \vc-dimension.

We will say \emph{dual \vc-dimension\/} for the \vc-dimension of $\phi^*$.

The \emph{\vc-density\/} of $\phi$ is the infimum over all real number $r$ such that $\pi_\phi(n)\in O(n^r)$.
It is infinite if no such $r$ exist.
The  \emph{dual \vc-density\/} is defined accordingly.\QED
\end{definition}


Then if the \vc-density is finite so is the \vc-dimension.
The converse is also true.
In fact, in the next section we show that the \vc-dimension bounds the \vc-density.

\begin{proposition}
If $\phi$ has \vc-dimension $< k$ then its dual \vc-dimension is $< 2^{k+1}$.
\end{proposition}

\begin{proof}
Assume that the \vc-dimension of $\phi^*$ is $\ge 2^k$.
We prove that the \vc-dimension of $\phi$ is $\ge k$.
Let $B=\{b_I\,:\,I\subseteq k\}$ be a set of cardinality $2^k$ shattered by $\phi^*$. 
That is, for every $\J\subseteq \P(k)$ there is $a_\J$ such that

\ceq{\hfill\phi(a_\J, b_I)}{\IFF}{I\in\J}

Let $a_i=a_{\{I\subseteq k\,:\, i\in I\}}$. Then from the equivalence above we obtain

\ceq{\hfill\phi(a_i, b_I)}{\IFF}{i\in I}

That is, $\phi$ shatters $\{a_i\,:\,i<k\}$.
\end{proof}

An alternative formalism uses \emph{set systems\/} in place of bipartite graphs.
A set system is a collection $\Phi$ of subsets of some set $\U$.
We denote a set system by \emph{$(\U,\Phi)$}.
Given a set system, we immediately obtain a bipartite graph.
Fix any $\V$ containing $\Phi$ and define $\phi(x,y)$ as $x\in y\in\Phi$.

Vice versa, to a bipartite graph $\phi$ we associate $\Phi=\phi(\U,b)_{b\in\V}$, the set system of the definable subsets of $\U$.
We say that a bipartite graph is \emph{extensional\/} if $\phi(\U,b)=\phi(\U,b')$ implies $b,b'\in\V$.
The correspondence between extensional incidence relations and set systems is one-to-one.
In general, the correspondence is many-to-one.
Even when we are interested set systems, in the proof it may be convenient to consider non extensional a bipartite graphs associated to these. So, we use the formalism which is most convenient in a given context.

The \emph{\vc-dimension of $\Phi$} is defined to be that of the associated incidence relation.
We repeat this explicitly in order to set the notation. Define


\ceq{\hfill\emph{$\Phi{\restriction} A$}}{=}{\big\{A\cap\B\ \ :\ \ \B\in \Phi\big\}.}

Then $A$ is shattered by $\Phi$ if $\P A=\Phi{\restriction} A$. The shatter function \emph{$\pi_\Phi(n)$\/} is

\ceq{\hfill\emph{$\pi_\Phi(n)$}}{=}{\max\bigg\{\big|\Phi{\restriction} A\big|\ \ :\ \ A\in {\U\choose n}\bigg\}.}



%An incidence relation is \emph{reduced\/} if $\phi(\U,b')=\phi(\U,b'')$ implies $b'=b''$ and, dually, $\phi(a',V)=\phi(a'',V)$ implies $a'=a''$.
%By quotienting and taking representatives, we can always find a reduced relation with the same shattering function.

\begin{example}\label{ex_vcdim}
\begin{itemize}
\item[a.] A bipartite graph of the form $A\times\V$ for some $A\subseteq\U$ shatters only the empty set, therefore it has \vc-dimension $0$.
Its shatter function is identically $1$.
\item[b.] Let $\Phi$ be a collection of disjoint subsets $\U$.
Then only singletons are shattered, so the \vc-dimension is $1$.
The shatter function is $\pi_\Phi(n)=\min\big\{n+1,|\Phi|\big\}$.
\item[c.] If $\Phi$ is a non-trivial chain of subsets of $\U$ the situation is identical to that described in \ssf{b}.
\item[d.] Let $\U=\RR$ and let $\Phi$ be the collection of open intervals.
Any set of 2 points is shattered but no set with 3 points can.
So the \vc-dimension is $2$.
\item[e.] Let $\U=\RR^2$ and let $\Phi$ be the collection of half planes.
Any set of 3 non collinear points is shattered but no set with 4 points can (by Radon's Theorem).
So the \vc-dimension is $3$.
\item[f.] Let $\Phi=U^{[\le k]}$ be the collection of all subsets of $\U$ of cardinality $\le k$.
Then $\Phi$ has \vc-dimension $k$ and

\noindent\kern19ex$\displaystyle\pi_\Phi(n)=\sum^k_{i=0} \binom{n}{i}$.

%Consider the type space $S_{\phi^*}(B)$ where $B\subseteq\V$ is a set of cardinality $k$. Note that for every 

\item[g.] Let $\U=\RR^2$ and let $\Phi$ be the collection of polygons.
Then $\Phi$ has infinite \vc-dimension.\QED
\end{itemize}
\end{example}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The Sauer-Shelah Lemma}

According to Gil Kalai in~\cite{kalai}, Sauer-Shelah's Lemma can been described as an \textit{eigentheorem\/} because it is important in many different areas of mathematic (model theory, learning theory, probability theory, ergodic theory, Banach spaces, to name a few).
No wonder it has been discovered and rediscovered may times.

It has been proved independently by Shelah~\cite{shelah72}, Sauer~\cite{sauer}, and Vapnik-Cher\-vo\-nen\-kis~\cite{VC} around 1970 (Shelah gives credit to Micha Perles).
Saharon Shelah was working in model theory while Norbert Sauer, Vladimir Vapnik and Alexey Chervonenkis were in statistical learning theory.

We shall present three proofs of this lemma, one in this section and two in the next section. I am aware of a forth proof which uses linear algebra, see e.g.~\cite{gowers}. 

\begin{proposition}[(Sauer-Shelah's Lemma)]\label{prop_Sauer}
If $\phi$ has \vc-dimension $k$ then for every $n\ge k$

\ceq{\hfill\pi_\phi(n)}{\le}{\bigsum^{k}_{i=0} \binom{n}{i}.} 
\end{proposition}

The set system presented in \ssf{f} of Example~\ref{ex_vcdim} shows that the bound is optimal.

\begin{proof}
If $k=0$, both sides of the inequality are $1$.
Now, assume the lemma is true for $k-1$.
We prove by induction on $n$ that for every $A$ of cardinality $n$

\ceq{\hfill\big|\phi(A,b)_{b\in\V}\big| }{\le}{\bigsum^{k}_{i=0} \binom{n}{i}.} 

If $n=k$ the r.h.s.\@ of the inequality above is $2^n$ and the claim is trivial.
So, assume the claim is true for $n-1$ and let $A$ have cardinality $n$.
Fix some $a\in A$ and let $A'=A\sm\{a\}$.
We can assume that $\phi(A,b)\simdiff\phi(A,b')=\{a\}$ for some $b,b'$, otherwise $\big|\phi(A,b)_{b\in\V}\big|=\big|\phi(A',b)_{b\in\V}\big|$ and the claim follows immediately from the induction hypothesis.

Define a new incidence relation

\ceq{\hfill\psi(x,y)}{=}{x\in A'\ \wedge\ \phi(x,y)\ \wedge\ \E y'\, \Big[\phi(A,y)\simdiff\phi(A,y')=\{a\}\Big].}

%\ceq{\hfill\psi(x,y)}{=}{\phi(x,y)\ \wedge\ \E y'\, \Big[\phi(A,y')\sm\phi(A,y)=\{a\}\Big].}

Note that if $A''$ is shattered by $\psi$ then $A''\cup\{a\}$ it is shattered by $\phi$.
Then the \vc-dimension of $\psi$ is at most $k-1$.
We also have that

\ceq{\hfill\big|\phi(A,b)_{b\in\V}\big|}{=}{\big|\phi(A',b)_{b\in\V}\big|\ +\ \big|\psi(A',b)_{b\in\V}\big|.}

Hence by induction hypothesis

\ceq{\hfill \big|\phi(A,b)_{b\in\V}\big|}{\le}{\bigsum^{k}_{i=0} \binom{n-1}{i}\ \  +\ \  \bigsum^{k-1}_{i=0}  \binom{n-1}{i}}

\ceq{}{=}{\binom{n-1}{0}\ \ +\ \ \bigsum^{k}_{i=1}\ \bigg[ \binom{n-1}{i}\ +\ \binom{n-1}{i-1}\bigg]}

\ceq{}{=}{\binom{n-1}{0}\ \ +\ \ \bigsum^{k}_{i=1}\ \ \binom{n}{i}}

\ceq{}{\le}{\bigsum^{k}_{i=0} \binom{n}{i}}

which completes the proof of the proposition.
\end{proof}

Next corollary states an important dichotomy.
It says that the shatter function grows exponentially unless the \vc-dimension is finite.
In this case the growth is only polynomial.
Therefore the \vc-dimension is an upper bond to the \vc-density.

\begin{corollary}\label{coroll_Sauer}
For every incidence relation $\phi$ one of the following obtains
\begin{itemize}
 \item[1.] the \vc-dimension is infinite and $\pi_\phi(n)=2^n$ for every positive integer $n$;
 \item[2.] the \vc-dimension is $k$ and $\pi_\phi(n)\ \in\ O(n^k)$.
\end{itemize}
\end{corollary}
\begin{proof}
If \vc-dimension is infinite claim \ssf{1} is obvious.
So assume $\phi$ has \vc-dimension is $k$.
Then

\ceq{\hfill \pi_\phi(n)}{\le}{\bigsum^k_{i=0}\binom{n}{i}}\medrel{\le}$\displaystyle\bigsum^k_{i=0}\frac{n^i}{i!}\medrel{\le}e\,n^k$%\bigg(\frac{e\,n}{k}\bigg)^k$.
\end{proof}

% The second proof of Sauer-Shelah's Lemma uses linear algebra.
%Timothy Gowers~\cite{gowers} credit Peter Frankl and Janos Pach.
% 
% \begin{void_thm}[Second proof of Sauer-Shelah's Lemma]\label{proof2_Pajor}\rm
% The 
% \end{void_thm}

\section{Pajor variant and the method of shifting}

An alternative proof of the Sauer-Shelah's Lemma derives it as corollary of a lemma by Alain Pajor~\cite{pajor}.
%The proof below is credited to Noga Alon by Kalai~\cite{kalai}, to (many) others by~\cite{ARS}.

\begin{proposition}[(Pajor's Lemma)]\label{prop_Pajor}
Let $A\subseteq\U$ be finite.
Then $\phi$ shatters at least $|S_\phi(A)|$ subsets of $A$.
\end{proposition}

We show how Sauer-Shelah's Lemma follows from Pajor's Lemma.
Fix a set $A\subseteq\U$ of cardinality $n$ such that $\pi_\phi(n)=\big|S_\phi(A)\big|$.
By Pajor's Lemma there are $|S_\phi(A)|$ subsets of $A$ shattered by $\phi$.
These subsets cannot have cardinality larger than the \vc-dimension of $\phi$, then 

\ceq{\hfill\pi_\phi(n)}{=}{|\phi(A,b)_{b\in\V}|\medrel{\le}\left|\bigcup^k_{i=0}{A\choose i}\right|\medrel{=}\sum^k_{i=0} \binom{n}{i}.}

\begin{proof}
If $A$ is empty then $|S_\phi(A)|=1$ and $\0$ is the only subset of $A$ that $\phi$ shatters.
Fix $a\in A$ and assume the lemma holds for $A'=A\sm\{a\}$.
Let $\psi$ be the relation defined in the proof of Prosition~\ref{prop_Sauer}.
Recall that

\ceq{\hfill\big|\phi(A,b)_{b\in\V}\big|}{=}{\big|\phi(A',b)_{b\in\V}\big|\ +\ \big|\psi(A',b)_{b\in\V}\big|.}

and that if $A''\subseteq A'$ is shattered by $\psi$ then $A''\cup\{a\}$ it is shattered by $\phi$.
By induction hypothesis $\phi$ shatters least $\big|\phi(A',b)_{b\in\V}\big|$ subsets of $A'$ and at least $\big|\psi(A',b)_{b\in\V}\big|$ containing $a$.
The lemma follows.

We present a different wording of essentially the same proof.
Consider the set system $\Phi=\phi(A,b)_{b\in\V}$ and reason by induction of $|\Phi|$.
The proposition holds trivially if $|\Phi|=1$.
Now, suppose it holds for set systems of cardinality $<|\Phi|$.
Fix $a\in A$ and let $\Phi_0=\big\{B\in\Phi : a\notin B\big\}$ and $\Phi_1=\Phi\sm\Phi_0$.
As $|\Phi|>1$, we can choose $a$ such that $\Phi_i\neq\Phi$.
By the inductive hypothesis, both $\Phi_i$ shatter at least $\big|\Phi_i\big|$ subsets of $A$.
If no set is shattered by both $\Phi_i$, the claim follows immediately.
Otherwise, note that for each set shattered by both $\Phi_i$ there are two sets shattered by $\Phi$, one containing $a$ and one not containing $a$.
The claim follows.
\end{proof}
 
We give different proof of Pajor's Lemma by a method which is interesting in itself because of its many applications.
The method has been introduced by Erd\H{o}s, Ko and Rado to prove their eponymous theorem.
They named it \textit{compression}, but is also known as \textit{shifting}.


When $A'\subseteq A$ and $A\sm A'=\{a\}$, we write \emph{$A'\subseteq_{a}\kern-1.5pt A$}. We write

\ceq{\hfill\emph{$B_{\phi,a}$}}{=}{\big\{b\ :\ \phi(a,b)\ {\rm and}\ \neg\E b'\,\phi(\U,b')\subseteq_a\phi(\U,b)\big\}}

We say that $\phi$ is \emph{compressed in $A$\/} if $B_{\phi,a}=\0$ for every $a\in A$.

\begin{proposition}\label{prop_compressed} 
Let $A$ be finite. If $\phi$ is compressed in $A$ then $\phi$ shatters every definable subset of $A$.
\end{proposition}

\begin{proof}
We claim that any subset of a definable subsets of $A$ is definable. If for contradiction $\phi(A,b)\sm\{a\}$ is not definable, then $b\in B_{\phi,a}$.
\end{proof}


\begin{proposition}\label{prop_conservative} Let $\psi=\phi\sm\{a\}{\times}B_{\phi,a}$.
Then

\ceq{\hfill\psi(\U,b)=\psi(\U,b')}{\IFF}{\phi(\U,b)=\phi(\U,b')}\hfill for all $b,b'\in\V$.
\end{proposition}

\begin{proof}
$\IMP$\quad Assume $\phi(\U,b)\neq\phi(\U,b')$.
We may also assume that $\phi(\U\sm\{a\},b)=\phi(\U\sm\{a\},b')$, otherwise $\psi(\U,b)\neq\psi(\U,b')$ is immediate.
Then $\phi(a,b)\niff\phi(a,b')$, say $ \phi(a,b)$ and $\neg \phi(a,b')$.
Then $\phi(\U,b')\subseteq_a\phi(\U,b)$ and $b\notin B_{\phi,a}$.
So $\psi(a,b)$ and $\neg \psi(a,b')$.

$\PMI$\quad If $\phi(\U,b)=\phi(\U,b')$ then $b\in B_{\phi,a}$ if and only if $b'\in B_{\phi,a}$.
Then it is clear that $\psi(\U,b)=\psi(\U,b')$.
%Assume $\psi(\U,b)\neq\psi(\U,b')$. 
% Again, we may also assume that $\psi(\U\sm\{a\},b)=\psi(\U\sm\{a\},b')$.
% Then $\psi(a,b)\niff\psi(a,b')$, say $\psi(a,b)$ and $\neg\psi(a,b')$.
% As $\phi(a,b)$ is clear, we only have to prove that $\neg\phi(a,b')$.
% Suppose for a contradiction that $\phi(a,b')$.
% Then $b'\in B_{\phi,a}$.
% This is a contradiction as $\psi(\U,b)\subseteq_a\phi(\U,b')$.
\end{proof}


\begin{proposition}\label{prop_shattered} 
Let $\psi=\phi\sm\{a\}{\times}B_{\phi,a}$.
Then every set shattered by $\psi$ is shattered by $\phi$.
\end{proposition}

\begin{proof}
Assume $A$ is shattered by $\psi$.
We prove that for every $b$ here is a $b'$ such that $\psi(A,b)=\phi(A,b')$.
We may assume that $a\in A$.
If $\psi(a,b)$ then we may chose $b=b'$.
So, assume $\neg\psi(a,b)$.
As $\psi$ shatters $A$ then there is $c$ such that $\psi(A,c)=\psi(A,b)\cup\{a\}$.
Then $\E b'\,\phi(\U,b')\subseteq_a\phi(\U,c)$.
Therefore $\psi(A,b)=\phi(A,b')$.
\end{proof}


\begin{void_thm}[Second proof of Pajor's Lemma]\label{proof2_Pajor}\rm
Let $\phi_0=\phi$ and $\phi_{i+1}=\phi_i\sm \{a\}{\times}B_{\phi_i,a}$ for some $a\in A$.
As $A$ is finite, we can assume that at some stage $n$ we obtain a relation $\psi=\phi_n$ that is compressed in $A$.
By Proposition~\ref{prop_compressed}, $\psi$ shatters all sets in $\psi(A,b)_{b\in\V}$.
By Proposition~\ref{prop_shattered}, every set shattered by $\psi$ is shattered by $\phi$.
By Proposition~\ref{prop_conservative}, $|\psi(A,b)_{b\in\V}|=|\phi(A,b)_{b\in\V}|$.\QED
\end{void_thm}

Finally, we present an other application of the shifting methods. Define $E_{\phi,a}\subseteq\V^2$ as the set of e pairs $\<b',b\>$ such that $\phi(\U,b')\subseteq_a\phi(\U,b)$. 
Note incidentally that $E_{\phi,a}$ is the graph of a partial injections of $\V$ into itself. 

We call $\displaystyle E_{\phi,A}=\bigcup_{a\in A}E_{\phi,a}$ the unit distance diagraph of $\phi$ in $A$. 

\begin{proposition}\label{prop_udd1} 
Let $\psi=\phi\sm\{a\}{\times}B_{\phi,a}$. Then $E_{\phi,A}\subseteq E_{\psi,A}$
\end{proposition}
\begin{proof}Both the range and the domain of $E_{\phi,a}$ are disjoint from $B_{\phi,a}$.
\end{proof}

\begin{proposition}
Let $\phi$ be a finite extensional incidence relation with \vc-dimension $k$.
Then $|E_\phi|\le k\,|\V|$.
\end{proposition}

\begin{proof}
Let $\psi$ be as defined in Proof~\ref{proof2_Pajor}.
By Propositions~\ref{prop_compressed} and~\ref{prop_shattered}, every $b\in\V$ has at most $k$ ancestors.
Therefore

\ceq{\hfill\frac{|E_\phi|}{|\V|}}{\le}{\frac{|E_\psi|}{|\V|}\medrel{\le}k}
\end{proof}

\begin{comment}
For $a\in\U$ and $B\in\Phi$ we define

\ceq{\hfill s_{a,\Phi}(B)}{=}%
{\left\{\begin{array}{ll}
B\sm\{a\} &{\rm if}\ a\in B\ {\rm and}\ B\sm\{a\}\notin\Phi\\
B &{\rm otherwise}\\
\end{array}\right.}

We write $s_a(\Phi)=\{s_{a,\Phi}(B) : B\in\Phi\}$.
We can think of $s_a(\Phi)$ as obtained by replacing $B$ with $B\sm\{a\}$ unless $\Phi$ already contains $B\sm\{a\}$.
This makes the function $s_a$ injective, hence $|s_a(\Phi)|=|\Phi|$.

\begin{proposition}\label{prop_shift_shatter}
If $A$ is shattered by $s_a(\Phi)$ then $A$ is also shattered by $\Phi$.
\end{proposition}

\begin{proof}
We prove that for every $B\in\Phi$ there is $C\in\Phi$ such that $A\cap s_{a,\Phi}(B)=A\cap C$.
We can assume that $a\in B$ and $s_{a,\Phi}(B)=B\sm\{a\}$, otherwise $C=B$.
Assume also that $a\in A$, otherwise again $C=B$ will do.
As $A$ is shattered by $s_a(\Phi)$, there is a $B'$ such that $A\cap s_{a,\Phi}(B')=A\cap B$.
Hence $a\in s_{a,\Phi}(B')=B'$.
By the definition of $s_a$, it must be that $B'\sm\{a\}\in\Phi$, otherwise $B'$ would have been replaced by $B'\sm\{a\}$.
So $C=B'\sm\{a\}$ proves the proposition.
\end{proof}

%Note that $s_a\cdot s_b=s_b\cdot s_a$.

\begin{exercise}
Let $\Phi_{\cap A}=\{B\cap A: B\in\Phi\}$.
Prove that  $s_a(\Phi)_{\cap A}\subseteq s_a(\Phi_{\cap A})$.
Derive Proposition~\ref{prop_shift_shatter} from this fact.\QED
\end{exercise}

\begin{void_thm}[Second proof of Pajor's Lemma]\label{proof2_Pajor}\rm
As $\Phi$ is finite we can assume $\U$ is finite.
Let $\Psi$ be the result of applying $s_a$ to $\Phi$ for all $a\in\U$.
From the discussion above it is clear that $|\Psi|=|\Phi|$ and that sets shattered by $\Psi$ are also shattered by $\Phi$.
We claim that if $A\subseteq B\in \Psi$ then $A\in \Psi$.
Note that this implies that all sets in $\Psi$ are shattered by $\Psi$, hence by $\Phi$.
So the proposition follows from the claim.
If the claim fails, there is a $B\in\Psi$ such that $B\sm\{a\}\notin\Psi$.
But this is not possible because $s_{a,\Phi}(B)=B\sm\{a\}$.\QED
\end{void_thm}


Given two incidence relations $\psi$ and $\phi$ we shall consider the following properties. 

\ceq{\#\hfill\psi(\U,b)=\psi(\U,b')}{\IMP}{\phi(\U,b)=\phi(\U,b')}\hfill for all $b,b'\in\V$.

\ceq{\#\#\hfill\psi(\U,b)=\psi(\U,b')}{\IFF}{\phi(\U,b)=\phi(\U,b')}\hfill for all $b,b'\in\V$.

\begin{proposition} 
Fix $\phi$ and let $\psi$ be minimal (w.r.t.\@ inclusion) among the relations that satisfy \ssf{\#}.
Then every subset of a $\psi$-definable set is $\psi$-definable.
The same holds with \ssf{\#\#} for \ssf{\#}.
\end{proposition}
\begin{proof}
Suppose for contradiction that $\psi(\U,b)\sm A'$ is not definable for some $A'\neq\0$.
Then $\psi'=\psi\sm A'{\times}\{b\}$ satisfies \ssf{\#} contradicting the minimality of $\psi$. The proof for \ssf{\#\#} is similar.
\end{proof}

%When $\psi\subseteq\phi$ and $\phi\sm\psi=\{\<a,b\>\}$, we write \emph{$\psi\subseteq_{\<a,b\>}\kern-1.5pt\phi$}.

When $A'\subseteq A$ and $A\sm A'=\{a\}$, we write \emph{$A'\subseteq_{a}\kern-1.5pt A$}.

\begin{proposition} Let $\psi=\phi\sm\{a\}{\times}B_{\phi,a}$ where

\ceq{\hfill B_{\phi,a}}{=}{\big\{b\ : \neg\E b'\,\phi(\U,b')\subseteq_a\phi(\U,b)\big\}}

Then $\psi$ satisfy \ssf{\#\#}.
\end{proposition}

\begin{proof}
$\IMP$\quad Assume $\phi(\U,b)\neq\phi(\U,b')$. 
We may also assume that $\phi(\U\sm\{a\},b)=\phi(\U\sm\{a\},b')$, otherwise $\psi(\U,b)\neq\psi(\U,b')$ is immediate.
Then $\phi(a,b)\niff\phi(a,b')$, say $ \phi(a,b)$ and $\neg \phi(a,b')$.
Then $\phi(\U,b')\subseteq_a\phi(\U,b)$ and $b\notin B_{\phi,a}$.
So $\psi(a,b)$ and $\neg \psi(a,b')$.

$\PMI$\quad Assume $\psi(\U,b)\neq\psi(\U,b')$. 
Again, we may also assume that $\psi(\U\sm\{a\},b)=\psi(\U\sm\{a\},b')$.
Then $\psi(a,b)\niff\psi(a,b')$, say $\psi(a,b)$ and $\neg\psi(a,b')$.
As $\phi(a,b)$ is clear, we only have to prove that $\neg\phi(a,b')$. 
Suppose for a contradiction that $\phi(a,b')$. 
Then $b'\in B_{\phi,a}$.
This is a contradiction as $\psi(\U,b)\subseteq_a\psi(\U,b')$.
\end{proof}




This $\psi$ will be constructed by stages.
That is, we define inductively $\phi_0,\dots,\phi_n$.
We let $\phi_0=\phi$ and $\phi_{i+1}=\phi_i\sm \{a\}{\times}B$ where

\ceq{\hfill B}{=}{\big\{b\ : \neg\E b'\,\phi(\U,b)\simdiff\phi(\U,b')=\{a\}\big\}}

 the pair $\{a\}{\times}B\subseteq\phi_i$ is such that


arbitrary subject to the condition that $\neg\E y\ \phi_i(\U,b)\simdiff\phi_i(\U,y)=\{a\}$.
We stop when  $\phi_n$ contains no applicable pair $\<a,b\>$.
Then we set $\psi=\phi_n$.



edges in $\{a\}{\times}V$ for some fixed $a\in\U$.
We define $\psi_a=\phi \sm \{a\}{\times} B$, where $B\subseteq\V$ is the largest set such that $\psi_a$ has the property \ssf{\#} above.
The set $B$ is uniquely determined by this requirement, namely

\ceq{\hfill B}{=}{\big\{b\ : \neg\E y\,\phi(\U,b)\simdiff\phi(\U,y)=\{a\}\big\}}














We say that $\psi$ is \emph{honest\/} on $A$ if for every $b$ there is a $b'$ such that
\begin{itemize}
\item[1.] $\psi(A,b)=\phi(A,b')$;
\item[2.] $\psi(\U,b)\subseteq\phi(\U,b')$.
\end{itemize}


\begin{proposition} 
If $\psi$ is honest on $A$ then it is honest on all subsets of $A$.
\end{proposition}
\begin{proof}
Assume that $\psi$ is honest on $A$.
We prove that is honest on $A\sm\{a\}$.
So, fix $b$. 
If $\psi(A,b)=\psi(A\sm\{a\},b)$ the claim is obvious, so assume $\psi(a,b)$.
By minimality, $\psi\sm\{\<a,b\>\}$ does not satisfy \ssf{\#}, then there is $c$ such that $\psi(\U,c)=\psi(\U,b)\sm\{a\}$. As $\psi$ is honest on $A$, there is $b'$ such that 
\begin{itemize}
\item[1.] $\psi(A\sm\{a\},b)=\psi(A,c)=\phi(A,b')=\phi(A\sm\{a\},b')$;
\item[2.] $\psi(\U,b)\subseteq\psi(\U,c)\subseteq\phi(\U,b')$.
\end{itemize}
The claim follows.
\end{proof}

This $\psi$ will be constructed by stages.
That is, we define inductively $\phi_0,\dots,\phi_n$.
We let $\phi_0=\phi$ and $\phi_{i+1}=\phi_i\sm\{\<a,b\>\}$ where the pair $\<a,b\>\in\phi_i$ is arbitrary subject to the condition that $\neg\E y\ \phi_i(\U,b)\simdiff\phi_i(\U,y)=\{a\}$.
We stop when  $\phi_n$ contains no applicable pair $\<a,b\>$.
Then we set $\psi=\phi_n$.



edges in $\{a\}{\times}V$ for some fixed $a\in\U$.
We define $\psi_a=\phi \sm \{a\}{\times} B$, where $B\subseteq\V$ is the largest set such that $\psi_a$ has the property \ssf{\#} above.
The set $B$ is uniquely determined by this requirement, namely

\ceq{\hfill B}{=}{\big\{b\ : \neg\E y\,\phi(\U,b)\simdiff\phi(\U,y)=\{a\}\big\}}

\begin{proposition}\label{prop_shift_shatter}
If $A$ is shattered by $\psi_a$ then $A$ is also shattered by $\phi$.
\end{proposition}

\begin{proof}
We may assume that $a\in A$.
We prove that for every $b$ here is a $b'$ such that $\psi_a(A,b)=\phi(A,b')$.
If $\psi_a(a,b)$ then we may chose $b=b'$.
So, assume $\neg\psi_a(a,b)$.
As $\psi_a$ shatters $A$ then there is $b'$ such that $\psi_a(A,b')=\psi_a(A,b)\cup\{a\}$.
Then $\E y\,\phi(\U,b')\simdiff\phi(\U,y)=\{a\}$.
Therefore $\psi_a(A,b)=\phi(a,y)$.
\end{proof}

Let $\psi_{a_1,\dots,a_n}=(\psi_{a_1,\dots,a_{n-1}})_{a_n}$.

\begin{void_thm}[Second version of second proof of Pajor's Lemma]\label{proof3_Pajor}\rm
As $\Phi=\phi(\U,b)_{b\in\V}$ is finite we can assume $\U$ is finite.
Let $\psi=\psi_{a_1,\dots,a_n}$.
From the discussion above it is clear that the $\psi$-definable sets and the $\phi$-definable sets are equinumerous.
Moreover they shatter the same sets.
We claim that $\psi$ shatters all $\psi$-definable sets.
So the proposition follows from the claim.
If the claim fails, there is a $b$ such that $\psi(\U,b)\sm\{a\}\notin\Psi$.
But this is not possible.\QED
\end{void_thm}

\end{comment}

\section{Notes and references}

\begin{biblist}[]\normalsize

\bib{ARS}{article}{
   author={Anstee, R. P.},
   author={R\'onyai, Lajos},
   author={Sali, Attila},
   title={Shattering news},
   journal={Graphs Combin.},
   volume={18},
   date={2002},
   number={1},
   pages={59--73},
   issn={0911-0119},
%   doi={10.1007/s003730200003},
}
\bib{gowers}{article}{
   author={Gowers, Timothy},
   title={\href{https://gowers.wordpress.com/2008/07/31/dimension-arguments-in-combinatorics}{Dimension arguments in combinatorics}},
   journal={Gowers's Weblog},
   date={2008}
}

\bib{kalai}{article}{
   author={Kalai, Gil} ,
   title={\href{https://gilkalai.wordpress.com/2008/09/28/extremal-combinatorics-iii-some-basic-theorems}{Extremal Combinatorics III: Some Basic Theorems}},
   journal={Combinatorics and more},
   date={2008}
}

\bib{pajor}{book}{
   author={Pajor, Alain},
   title={Sous-espaces $l^n_1$ des espaces de Banach},
%   language={French},
   series={Travaux en Cours [Works in Progress]},
   volume={16},
%   note={With an introduction by Gilles Pisier},
%   publisher={Hermann, Paris},
   date={1985},
   pages={xii+112},
   isbn={2-7056-6021-6}
}
\bib{sauer}{article}{
   author={Sauer, N.},
   title={On the density of families of sets},
   journal={J. Combinatorial Theory Ser. A},
   volume={13},
   date={1972},
   pages={145--147},
}

\bib{shelah72}{article}{
   author={Shelah, Saharon},
   title={A combinatorial problem; stability and order for models and theories in infinitary languages},
   journal={Pacific J. Math.},
   volume={41},
   date={1972},
   pages={247--261},
}

\bib{VC}{article}{
   author={Vapnik, V. N.},
   author={Chervonenkis, A. Ya.},
   title={On the uniform convergence of relative frequencies of events to their probabilities},
   note={Reprint of Theor. Probability Appl. {\bf 16} (1971), 264--280},
   conference={title={Measures of complexity},},
   book={publisher={Springer, Cham},},
   date={2015},
   pages={11--30},
}
\end{biblist}


 
 
\end{document}
